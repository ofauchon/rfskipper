<!DOCTYPE html>
<html>
<body>

    <h2>RFSkipper Pulses Display</h2>
    <p align=center>
        <textarea id="text1" style="width:400px;height:300px;border:1px solid;">20;11;DEBUG;Pulses=121;Pulses(uSec)=490,480,500,480,490,480,500,480,490,480,500,480,500,960,990,480,500,950,510;</textarea><br>
        <button type="button" onclick="myFunction()">Generer</button>
        <div id="svg54583"></div>
    </p>
    <script>
        function myFunction() {
            //var s = '20;19;DEBUG;Pulses=121;Pulses(uSec)=500,470,510,470,500,470,510,470,500,470,510,470,510,460,510,470,510,460,510,470,510,460,510,470,510,470,500,470,510,470,500,470,510,460,510,470,510,470,500,470,510,470,500,470,510,470,500,960,990,960,510,460,510,470,1000,460,510,960,500,470,1000,950,510,470,990,960,990,470,510,950,1000,470,510,950,990,960,990,960,510,470,500,470,510,470,990,960,510,460,1000,470,500,960,990,960,990,960,500,470,510,470,500,480,500,470,510,470,500,470,500,480,990,470,510,950,1000,960,500,470,990,470,510;';

            var s = document.getElementById('text1').value;

            var fields = s.match(/.*\(uSec\)=(.*);/);
            console.log(fields);
            var pulses = fields[1].split(/,/);
            console.log(pulses);

            const svg1 = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            // set width and height
            imageHeight = 100;
            imageWidth = 1000;

            svg1.setAttribute("width", "1000");
            svg1.setAttribute("height", "100");

            posX = 0;
            pix_per_ms = 0.01;
            oldH = imageHeight * 0.9;
            totalWidth = 0;

            for (i = 0; i < pulses.length; i++) {
                console.log("pulse #" + i + " len:" + pulses[i] + "ms");


                newH = imageHeight * 0.1;
                if (i % 2) {
                    newH = imageHeight * 0.9;
                }

                wi = (pulses[i] * pix_per_ms)
                totalWidth += wi;

                var newLineH = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                //newLine.setAttribute('id', 'line2');
                newLineH.setAttribute('x1', posX);
                newLineH.setAttribute('y1', newH);
                newLineH.setAttribute('x2', posX + wi);
                newLineH.setAttribute('y2', newH);
                newLineH.setAttribute("stroke", "black");
                svg1.appendChild(newLineH);
                console.log("- " + posX + "x" + newH + "x" + (posX + wi) + "x" + newH);


                posX += wi;

                var newLineV = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                //newLine.setAttribute('id', 'line2');
                newLineV.setAttribute('x1', posX);
                newLineV.setAttribute('y1', oldH);
                newLineV.setAttribute('x2', posX);
                newLineV.setAttribute('y2', newH);
                newLineV.setAttribute("stroke", "red");
                svg1.appendChild(newLineV);
                console.log("| " + posX + "x" + oldH + "x" + posX + "x" + newH);

                oldH = newH;



            }
            svg1.setAttribute("width", totalWidth);



            // attach container to document
            document.getElementById("svg54583").appendChild(svg1);


        }
    </script>

</body>

</html>